<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>Shape Detection Demo</title>
<style>
  .center {
    margin: auto;
    display: block;
  }
  .myButton {
    background-color:#44c767;
    -moz-border-radius:7px;
    -webkit-border-radius:7px;
    border-radius:7px;
    border:1px solid #18ab29;
    cursor:pointer;
    color:#ffffff;
    font-family:Arial;
    font-size:14px;
    padding:5px 5px;
    text-decoration:none;
    text-shadow:0px 1px 0px #2f6627;
  }
  .myButton:hover {
    background-color:#5cbf2a;
  }
  .myButton:active {
    position:relative;
    top:1px;
  }
  canvas {
    border:3px solid #d3d3d3;
    width:66%;
  }
</style>
</head>

<body>
  <input id="imageLoader" class="center" type="file""><br/>

  <img hidden id="myImage" src="https://skybiometry.com/wp-content/uploads/2015/09/work-2-1-e1451907791984.jpg">

  <canvas id="myCanvas"  class="center">
  Your browser does not support the HTML5 canvas tag.
  </canvas><br/>

  <button class="myButton center" onclick="drawFaceBoundingBoxes()">Click to get bounding boxes</button>

</body>

<script>
  var c = document.getElementById("myCanvas");
  var ctx = c.getContext("2d");
  var img = document.getElementById("myImage");


  function drawImageOnCanvas(image) {
      c.width = image.width + 20;
      c.height = image.height + 20;
      ctx.drawImage(image, 10, 10);
  }

  function drawFaceBoundingBoxes() {
    console.log(img);
    var detector = new FaceDetector();
    detector.detect(img)
      .then(faceDetectionResult => {
        for (var i=0; i<faceDetectionResult.length; i++) {
          var boundingBox = faceDetectionResult[i];
          ctx.lineWidth=10;
          ctx.strokeStyle="red";
          ctx.rect(
            Math.floor(10+boundingBox.x),
            Math.floor(10+boundingBox.y),
            Math.floor(boundingBox.width),
            Math.floor(boundingBox.height)
          );
          ctx.stroke();
        }
      })
      .catch(error => {
        alert(error);
      });
  }

var imageLoader = document.getElementById('imageLoader');
    imageLoader.addEventListener('change', handleImage, false);

function handleImage(e){
  console.log("If crashes after selecting file, see ");
    var reader = new FileReader();
    reader.onload = function(event){
        var img = new Image();
        img.onload = function(){
          drawImageOnCanvas(img);
        }
        img.src = event.target.result;
    }
    reader.readAsDataURL(e.target.files[0]);
}

  window.onload = function() {
    drawImageOnCanvas(img);
  }

</script>
</html>
