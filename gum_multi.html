<!DOCTYPE html>
<!-- saved from url=(0070)http://webrtc.googlecode.com/svn/trunk/samples/js/demos/html/gum1.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>Multiple cameras getUserMedia() demo</title>
<style>
video { border:5px solid black; width:400px; height:300px; }
button { font: 18px sans-serif; padding: 8px; }
</style>
</head>
<body>
  <div>
    <h1>Test opening and combination of video capture devices</h1>
    <p>
    This page tries to open two cameras identified by ID. 
    If there's less than two cameras connected to the browser, it won't work 
    correctly :) and if there's more than two, the first two will be used.
    </p>
  </div>
<textarea id="textarea" name="textarea" rows="2" cols="80" style="border: none; resize: none"></textarea>
<br/>  
<button id="btn" onclick="capture()">Start Video Capture(s)</button>
<script>
var camera_ids = new Array();
function refreshSources() {
  MediaStreamTrack.getSources(function(sourceInfos) {
    var count = 0;
    document.getElementById('textarea').value = "";
    for (var index in sourceInfos) {
      var sourceInfo = sourceInfos[index];
      console.log( " hi : " + sourceInfo.label + " " + sourceInfo.kind);
      if (sourceInfo.kind != 'video') 
        continue;
      camera_ids[count++] = sourceInfo;
      var message = "Video capture dev # "+ count + " : " + sourceInfo.label;
      console.log(message);
      document.getElementById('textarea').value += message + "\n";
    }
  });
}
refreshSources();

function capture() {
  console.log("Requesting " + camera_ids.length + " video device(s)");
  for (var index in camera_ids) {
    var sourceId = camera_ids[index].id;
    var constraints = "{audio : false," + 
                      " video : { optional : [ {sourceId: " + sourceId  + " }]}";
    console.log("Requesting getUserMedia: " + constraints);
    navigator.webkitGetUserMedia(constraints, gotStream,  getUserMediaError); 
  }
  btn.disabled = true;
}
function gotStream(stream) {    
  console.log("Got video device");
  var video_tag = document.createElement('video');
  video_tage.src = webkitURL.createObjectURL(stream);
}
function getUserMediaError(e) {
  console.assert(false, 'Error during webkitGetUserMedia: '+ e);
}

</script>
</body>
</html>
