<!DOCTYPE html>
<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>Multiple cameras getUserMedia() demo</title>
<script>
/* global webkitURL */
/* global MediaStreamTrack */

var cameraIds = new Array();
function refreshSources() {
  MediaStreamTrack.getSources(function(sourceInfos) {
    var count = 0;
    document.getElementById('textarea').value = "";
    for (var index in sourceInfos) {
      var sourceInfo = sourceInfos[index];
      if (sourceInfo.kind != 'video') 
        continue;
      cameraIds[count++] = sourceInfo;
      var message = "Video capture dev # "+ count + " : " + sourceInfo.label;
      console.log(message);
      document.getElementById('textarea').value += message + "\n";
    }
  });
}

function capture() {
  console.log("Requesting " + cameraIds.length + " video device(s)");
  for (var index in cameraIds) {
    var constraints = { audio : false };
    constraints.video = { optional : [{ sourceId: cameraIds[index].id }] };

    console.log("Requesting getUserMedia: " + JSON.stringify(constraints));
    navigator.webkitGetUserMedia(constraints, gotStream, getUserMediaError); 
  }
  button.disabled = true;
}
function gotStream(stream) {    
  console.log("Got video device");
  var video_tag = document.createElement('video');
  video_tag.src = webkitURL.createObjectURL(stream);
  
  document.body.appendChild(video_tag);
  video_tag.play();
}
function getUserMediaError(e) {
  console.assert(false, 'Error during webkitGetUserMedia: '+ e);
}

var button = document.createElement("btn");
button.onclick = capture;
button.type = "button";
document.body.appendChild(button);

refreshSources();

</script>
</head>

<body>
  <div> This page lists all Video Capture devices and tries to open each of them in sequence. </div>
  <textarea id="textarea" name="textarea" rows="2" cols="80" style="border: none; resize: none"></textarea>
  <br/>  
  <button id="btn">Start all Video Capturer(s)</button>
  <br/>
</body>
</html>
